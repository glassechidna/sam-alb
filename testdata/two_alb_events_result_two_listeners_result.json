{
  "Transform": "AWS::Serverless-2016-10-31",
  "Resources": {
    "Function": {
      "Type": "AWS::Serverless::Function",
      "Properties": {
        "Handler": "index.handler",
        "Runtime": "nodejs12.x",
        "MemorySize": 256,
        "CodeUri": "./func",
        "Timeout": 60,
        "AutoPublishAlias": "live",
        "Events": {
          "SomeApi": {
            "Type": "HttpApi"
          }
        }
      }
    },
    "FunctionAlbHostEventListenerRule": {
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
      "Properties": {
        "Priority": 30000,
        "ListenerArn": {
          "Ref": "abc2"
        },
        "Actions": [
          {
            "Type": "forward",
            "TargetGroupArn": {
              "Ref": "FunctionAlbTargetGroupabc2"
            }
          }
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "example.com"
              ]
            }
          }
        ]
      }
    },
    "FunctionAlbPathEventListenerRule": {
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
      "Properties": {
        "Priority": 40000,
        "ListenerArn": {
          "Ref": "abc"
        },
        "Actions": [
          {
            "Type": "forward",
            "TargetGroupArn": {
              "Ref": "FunctionAlbTargetGroupabc"
            }
          }
        ],
        "Conditions": [
          {
            "Field": "path-pattern",
            "PathPatternConfig": {
              "Values": [
                "/example"
              ]
            }
          }
        ]
      }
    },
    "FunctionAlbTargetGroupabc": {
      "DependsOn": [
        "FunctionAlbPermission"
      ],
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
      "Properties": {
        "TargetType": "lambda",
        "Targets": [
          {
            "Id": {
              "Ref": "Function.Alias"
            }
          }
        ]
      }
    },
    "FunctionAlbTargetGroupabc2": {
      "DependsOn": [
        "FunctionAlbPermission"
      ],
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
      "Properties": {
        "TargetType": "lambda",
        "Targets": [
          {
            "Id": {
              "Ref": "Function.Alias"
            }
          }
        ]
      }
    },
    "FunctionAlbPermission": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "Principal": "elasticloadbalancing.amazonaws.com",
        "SourceArn": {
          "Fn::Sub": "arn:aws:elasticloadbalancing:${AWS::Region}:${AWS::AccountId}:targetgroup/*"
        },
        "FunctionName": {
          "Ref": "Function.Alias"
        }
      }
    },
    "Function2": {
      "Type": "AWS::Serverless::Function",
      "Properties": {
        "Handler": "index.handler",
        "Runtime": "nodejs12.x",
        "MemorySize": 256,
        "CodeUri": "./func",
        "Timeout": 60,
        "AutoPublishAlias": "live",
        "Events": {
          "SomeApi": {
            "Type": "HttpApi"
          }
        }
      }
    },
    "Function2AlbHostEventListenerRule": {
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
      "Properties": {
        "Priority": 30000,
        "ListenerArn": {
          "Ref": "xyz2"
        },
        "Actions": [
          {
            "Type": "forward",
            "TargetGroupArn": {
              "Ref": "Function2AlbTargetGroupxyz2"
            }
          }
        ],
        "Conditions": [
          {
            "Field": "host-header",
            "HostHeaderConfig": {
              "Values": [
                "example.com"
              ]
            }
          }
        ]
      }
    },
    "Function2AlbPathEventListenerRule": {
      "Type": "AWS::ElasticLoadBalancingV2::ListenerRule",
      "Properties": {
        "Priority": 40000,
        "ListenerArn": {
          "Ref": "xyz"
        },
        "Actions": [
          {
            "Type": "forward",
            "TargetGroupArn": {
              "Ref": "Function2AlbTargetGroupxyz"
            }
          }
        ],
        "Conditions": [
          {
            "Field": "path-pattern",
            "PathPatternConfig": {
              "Values": [
                "/example"
              ]
            }
          }
        ]
      }
    },
    "Function2AlbTargetGroupxyz": {
      "DependsOn": [
        "Function2AlbPermission"
      ],
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
      "Properties": {
        "TargetType": "lambda",
        "Targets": [
          {
            "Id": {
              "Ref": "Function2.Alias"
            }
          }
        ]
      }
    },
    "Function2AlbTargetGroupxyz2": {
      "DependsOn": [
        "Function2AlbPermission"
      ],
      "Type": "AWS::ElasticLoadBalancingV2::TargetGroup",
      "Properties": {
        "TargetType": "lambda",
        "Targets": [
          {
            "Id": {
              "Ref": "Function2.Alias"
            }
          }
        ]
      }
    },
    "Function2AlbPermission": {
      "Type": "AWS::Lambda::Permission",
      "Properties": {
        "Action": "lambda:InvokeFunction",
        "Principal": "elasticloadbalancing.amazonaws.com",
        "SourceArn": {
          "Fn::Sub": "arn:aws:elasticloadbalancing:${AWS::Region}:${AWS::AccountId}:targetgroup/*"
        },
        "FunctionName": {
          "Ref": "Function2.Alias"
        }
      }
    }
  }
}